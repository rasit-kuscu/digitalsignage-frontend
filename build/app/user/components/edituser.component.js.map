{"version":3,"sources":["app/user/components/edituser.component.ts"],"names":[],"mappings":"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","file":"app/user/components/edituser.component.js","sourcesContent":["import { Component, OnInit } from \"@angular/core\";\nimport { Router, ROUTER_DIRECTIVES, ActivatedRoute } from '@angular/router';\nimport { tokenNotExpired } from 'angular2-jwt';\nimport { REACTIVE_FORM_DIRECTIVES, FormBuilder, Validators, FormControl } from '@angular/forms';\nimport { Http } from '@angular/http';\nimport { NotificationsService, SimpleNotificationsComponent } from 'notifications';\nimport { ValidationService } from '../../common/services/validation.service';\nimport { LoaderAnimation } from '../../common/components/loader.animation';\nimport { PermissionDenied } from '../../common/components/permission.denied';\nimport { ControlMessages } from '../../common/components/control.messages';\nimport { UserService } from '../services/user.service';\nimport { User } from '../models/user';\nimport { Group } from '../../group/models/group';\nimport { GroupService } from '../../group/services/group.service';\nimport { Role } from '../../role/models/role';\nimport { RoleService } from '../../role/services/role.service';\nimport 'rxjs/add/operator/map';\nimport { Observable } from 'rxjs/Observable';\n\n@Component({\n\tselector: \"newuser\",\n\ttemplateUrl: \"./app/user/components/edituser.html\",\n\tdirectives: [ROUTER_DIRECTIVES, REACTIVE_FORM_DIRECTIVES, SimpleNotificationsComponent, LoaderAnimation, ControlMessages, PermissionDenied],\n\tproviders: [UserService, GroupService, RoleService, NotificationsService]\n})\nexport class EditUserComponent implements OnInit {\n\tisSaving:boolean = false;\n  isDataAvailable:boolean = false;\n\tisPermissionOkay:boolean = true;\n  defaultGroupIdValue:number;\n  editUserForm:any;\n  notificationOptions = {timeOut: 5000, maxStack: 1};\n\tuser:User[];\n\tgroupList:Group[];\n\troleList:Role[];\n\tformGroupArr:FormControl[] = [];\n\tformRoleArr:FormControl[] = [];\n\tuserId:number;\n\n  constructor(private _userService: UserService,\n\t\tprivate _groupService: GroupService,\n\t\tprivate _roleService: RoleService,\n\t\tprivate formBuilder: FormBuilder,\n\t\tprivate _notificationService: NotificationsService,\n\t\tpublic router:Router,\n\t\tprivate activatedRoute: ActivatedRoute) {\n  }\n\n\tngOnInit() {\n\t\tthis.userId = this.activatedRoute.params.value['id'];\n\t\tObservable.forkJoin(\n\t\t\tthis._userService.load(this.userId),\n\t\t\tthis._groupService.load(),\n\t\t\tthis._roleService.load()\n\t\t).subscribe(\n      response => {\n\t\t\t\tif (response[0].status === 'success' && response[1].status === 'success' && response[2].status === 'success') {\n\t\t\t\t\tthis.user = response[0].data;\n\t\t\t\t\tthis.groupList = response[1].data;\n\t\t\t\t\tthis.roleList = response[2].data;\n\n\t\t\t\t\tthis.populateCheckBoxes();\n\t\t\t\t\tthis.prepareForm();\n\t\t\t\t\tthis.isDataAvailable = true;\n\t\t\t\t}\n\t\t\t},\n\t\t\terror => {\n\t\t\t\tthis.router.navigate(['/error', {status: error.status, message: encodeURIComponent(error.statusText)}]);\n\t\t\t}\n\t\t);\n\t}\n\n\tprepareForm() {\n\t\tthis.editUserForm = this.formBuilder.group({\n\t\t\t'username': [this.user.username, Validators.required],\n\t\t\t'email': [this.user.email, [Validators.required, ValidationService.emailValidator]],\n\t\t\t'groups': this.formBuilder.group(this.formGroupArr, {validator: ValidationService.checkboxGroupValidator}),\n\t\t\t'roles': this.formBuilder.group(this.formRoleArr, {validator: ValidationService.checkboxGroupValidator}),\n\t\t\t'passwords': this.formBuilder.group({\n\t\t\t\t'password': ['', ValidationService.passwordValidatorChange],\n\t\t\t\t're_password': ['']\n\t\t\t}, {validator: ValidationService.passwordMatch})\n\t\t});\n\t}\n\n\tpopulateCheckBoxes() {\n\t\tfor (let group of this.groupList) {\n\t\t\tif (this.user.groups.indexOf(group.id) !== -1) {\n\t\t\t\tgroup.isChecked = true;\n\t\t\t} else {\n\t\t\t\tgroup.isChecked = false;\n\t\t\t}\n\t\t\tthis.formGroupArr[group.id] = new FormControl(true);\n\t\t}\n\n\t\tfor (let role of this.roleList) {\n\t\t\tif (this.user.roles.indexOf(role.id) !== -1) {\n\t\t\t\trole.isChecked = true;\n\t\t\t} else {\n\t\t\t\trole.isChecked = false;\n\t\t\t}\n\t\t\tthis.formRoleArr[role.id] = new FormControl(true);\n\t\t}\n\t}\n\n\tupdateCheckedOptions(option, event) {\n\t\tif (option.isChecked) {\n\t\t\toption.isChecked = false;\n\t\t} else {\n\t\t\toption.isChecked = true;\n\t\t}\n\t}\n\n\tsave() {\n\t\tlet groups:number[] = [];\n\t\tlet roles:number[] = [];\n\n\t\tfor (let group of this.groupList) {\n\t\t\tif (group.isChecked) {\n\t\t\t\tgroups.push(group.id);\n\t\t\t}\n\t\t}\n\n\t\tfor (let role of this.roleList) {\n\t\t\tif (role.isChecked) {\n\t\t\t\troles.push(role.id);\n\t\t\t}\n\t\t}\n\n\t\tthis._notificationService.alert('Kaydediliyor', 'İşleminiz yapılıyor, lütfen bekleyiniz.', {timeOut:0, clickToClose:false});\n\t\tthis.isSaving = true;\n\t\tthis._userService.update(new User(this.userId,\n\t\t\tthis.editUserForm.value.username,\n\t\t\tthis.editUserForm.value.email,\n\t\t\tthis.editUserForm.value.passwords.password,\n\t\t\tgroups,\n\t\t\troles))\n\t\t.subscribe(\n\t\t\t(response) => {\n\t\t\t\tthis.isSaving = false;\n\t\t\t\tif (response.status === 'success') {\n\t\t\t\t\tthis.isSaving = true;\n\t\t\t\t\tthis._notificationService.success('İşlem Başarılı', 'Kullanıcı bilgileri güncellendi.', {});\n\t\t\t\t} else if (response.status === 'fail') {\n\t\t\t\t\tif (response.message === 'user_username_exists') {\n\t\t\t\t\t\tthis._notificationService.error('Hata', 'Girilen kullanıcı adı kayıtlı.', {});\n\t\t\t\t\t} else if (response.message === 'user_email_exists') {\n\t\t\t\t\t\tthis._notificationService.error('Hata', 'Girilen email adresi zaten kayıtlı.', {});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\terror => {\n\t\t\t\tthis.router.navigate(['/error', {status: error.status, message: encodeURIComponent(error.statusText)}]);\n\t\t\t}\n\t\t);\n\t}\n}\n"],"sourceRoot":"/source/"}