{"version":3,"sources":["app/role/components/role.edit.component.ts"],"names":[],"mappings":"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","file":"app/role/components/role.edit.component.js","sourcesContent":["import { Component, OnInit } from \"@angular/core\";\nimport { Router, ROUTER_DIRECTIVES, ActivatedRoute } from '@angular/router';\nimport { REACTIVE_FORM_DIRECTIVES, FormBuilder, Validators, FormControl } from '@angular/forms';\nimport { Http } from '@angular/http';\nimport { NotificationsService, SimpleNotificationsComponent } from 'angular2-notifications';\nimport { ValidationService } from '../../common/services/validation.service';\nimport { LoaderAnimation } from '../../common/components/loader.animation';\nimport { ControlMessages } from '../../common/components/control.messages';\nimport { Role } from '../../role/models/role';\nimport { Privilege } from '../../role/models/privilege';\nimport { RoleService } from '../../role/services/role.service';\nimport { PrivilegeService } from '../../role/services/privilege.service';\nimport 'rxjs/add/operator/map';\nimport { Observable } from 'rxjs/Observable';\n\n@Component({\n\tselector: \"role-edit\",\n\ttemplateUrl: \"./app/role/components/role.edit.html\",\n\tdirectives: [ROUTER_DIRECTIVES, REACTIVE_FORM_DIRECTIVES, SimpleNotificationsComponent, ControlMessages, LoaderAnimation],\n\tproviders: [RoleService, PrivilegeService, NotificationsService]\n})\nexport class RoleEditComponent implements OnInit {\n\tnotificationOptions = {timeOut: 5000, maxStack: 1};\n\tisSaving:boolean = false;\n\tisDataAvailable:boolean = false;\n  editRoleForm:any;\n\trole:Role;\n\troleId: number;\n\tprivilegeList: any[];\n\tformPrivilegeArr:FormControl[] = [];\n\n  constructor(\n\t\tprivate _roleService: RoleService,\n\t\tprivate _privilegeService: PrivilegeService,\n\t\tprivate formBuilder: FormBuilder,\n\t\tprivate _notificationService: NotificationsService,\n\t\tpublic router:Router,\n\t\tprivate activatedRoute: ActivatedRoute) {\n  }\n\n\tngOnInit() {\n\t\tthis.roleId = this.activatedRoute.snapshot.params['id'];\n\t\tObservable.forkJoin(\n\t\t\tthis._roleService.detail(this.roleId),\n\t\t\tthis._privilegeService.load()\n\t\t).subscribe(\n      response => {\n\t\t\t\tif (response[0].status === 'success' && response[1].status === 'success') {\n\t\t\t\t\tthis.role = response[0].data;\n\t\t\t\t\tthis.privilegeList = response[1].data;\n\t\t\t\t\tthis.populateCheckBoxes();\n\n\t\t\t\t\tthis.prepareForm();\n\t\t\t\t\tthis.isDataAvailable = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis.router.navigate(['/error', {status: response[0].status, message: encodeURIComponent(response[0].message)}]);\n\t\t\t\t}\n\t\t\t},\n\t\t\terror => {\n\t\t\t\tthis.router.navigate(['/error', {status: error.status, message: encodeURIComponent(error._body)}]);\n\t\t\t}\n\t\t);\n\t}\n\n\tprepareForm() {\n\t\tthis.editRoleForm = this.formBuilder.group({\n\t\t\t'name': [this.role['name'], Validators.required],\n\t\t\t'privileges': this.formBuilder.group(this.formPrivilegeArr, {validator: ValidationService.checkboxGroupValidator})\n\t\t});\n\t}\n\n\tpopulateCheckBoxes() {\n\t\tfor (let privilege of this.privilegeList) {\n\t\t\tlet index = this.role['privileges'].map(function(x) { return x.id; }).indexOf(privilege.id);\n\t\t\tif (index >= 0) {\n\t\t\t\tprivilege.isChecked = true;\n\t\t\t} else {\n\t\t\t\tprivilege.isChecked = false;\n\t\t\t}\n\t\t\tthis.formPrivilegeArr[privilege.id] = new FormControl(true);\n\t\t}\n\t}\n\n\tupdateCheckedOptions(option, event) {\n\t\tif (option.isChecked) {\n\t\t\toption.isChecked = false;\n\t\t} else {\n\t\t\toption.isChecked = true;\n\t\t}\n\t}\n\n\tsave() {\n\t\tlet privileges:number[] = [];\n\n\t\tfor (let privilege of this.privilegeList) {\n\t\t\tif (privilege.isChecked) {\n\t\t\t\tprivileges.push(privilege.id);\n\t\t\t}\n\t\t}\n\n\t\tthis._notificationService.alert('Kaydediliyor', 'İşleminiz yapılıyor, lütfen bekleyiniz.', {timeOut:0, clickToClose:false});\n\t\tthis.isSaving = true;\n\t\tthis._roleService.update(new Role(this.roleId,\n\t\t\tthis.editRoleForm.value.name,\n\t\t\tprivileges))\n\t\t.subscribe(\n\t\t\t(response) => {\n\t\t\t\tthis.isSaving = false;\n\t\t\t\tif (response.status === 'success') {\n\t\t\t\t\tthis._notificationService.success('İşlem Başarılı', 'Yetki bilgileri güncellendi.', {});\n\t\t\t\t} else if (response.status === 'fail') {\n\t\t\t\t\tif (response.message === 'role_name_taken') {\n\t\t\t\t\t\tthis._notificationService.error('Hata', 'Girilen yetki adı kayıtlı.', {});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\terror => {\n\t\t\t\tthis.router.navigate(['/error', {status: error.status, message: encodeURIComponent(error._body)}]);\n\t\t\t}\n\t\t);\n\t}\n}\n"],"sourceRoot":"/source/"}